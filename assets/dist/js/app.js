import*as THREE from"three";import{TrackballControls}from"three/examples/jsm/controls/TrackballControls.js";const gsap=window.gsap,canvas=document.querySelector("canvas.webgl"),scene=new THREE.Scene,overlayGeometry=new THREE.PlaneBufferGeometry(2,2,1,1),overlayMaterial=new THREE.ShaderMaterial({transparent:!0,uniforms:{uAlpha:{value:1}},vertexShader:"\n    void main()\n    {\n      gl_Position = vec4(position, 1.0);\n    }\n  ",fragmentShader:"\n      uniform float uAlpha;\n      void main()\n      {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, uAlpha);\n      }\n    "}),overlay=new THREE.Mesh(overlayGeometry,overlayMaterial);scene.add(overlay);const loadingBarElement=document.querySelector(".loading-bar"),loadingManager=new THREE.LoadingManager((()=>{gsap.delayedCall(.5,(()=>{gsap.to(overlayMaterial.uniforms.uAlpha,{duration:3,value:0}),loadingBarElement.classList.add("ended"),loadingBarElement.style.transform=""}))}),((e,s)=>{const t=e/s;console.log(e),loadingBarElement.style.transform=`scaleX( ${t} )`})),textureLoader=new THREE.TextureLoader(loadingManager);let imghorizon=["assets/images/webhorizontales/2.jpg","assets/images/webhorizontales/1.jpg","assets/images/webhorizontales/3.jpg","assets/images/webhorizontales/4.jpg","assets/images/webhorizontales/5.jpg","assets/images/webhorizontales/6.jpg","assets/images/webhorizontales/7.jpg","assets/images/webhorizontales/8.jpg","assets/images/webhorizontales/9.jpg","assets/images/webhorizontales/10.jpg","assets/images/webhorizontales/11.jpg","assets/images/webhorizontales/12.jpg","assets/images/webhorizontales/13.jpg","assets/images/webhorizontales/14.jpg","assets/images/webhorizontales/15.jpg","assets/images/webhorizontales/16.jpg","assets/images/webhorizontales/17.jpg","assets/images/webhorizontales/19.jpg","assets/images/webhorizontales/20.jpg","assets/images/webhorizontales/21.jpg","assets/images/webhorizontales/22.jpg","assets/images/webhorizontales/24.jpg","assets/images/webhorizontales/25.jpg","assets/images/webhorizontales/26.jpg","assets/images/webhorizontales/27.jpg","assets/images/webhorizontales/28.jpg","assets/images/webhorizontales/29.jpg","assets/images/webhorizontales/30.jpg","assets/images/webhorizontales/31.jpg","assets/images/webhorizontales/32.jpg","assets/images/webhorizontales/33.jpg","assets/images/webhorizontales/34.jpg","assets/images/webhorizontales/35.jpg","assets/images/webhorizontales/36.jpg","assets/images/webhorizontales/37.jpg","assets/images/webhorizontales/38.jpg","assets/images/webhorizontales/39.jpg","assets/images/webhorizontales/41.jpg","assets/images/webhorizontales/42.jpg","assets/images/webhorizontales/43.jpg"],imgverticale=["assets/images/webverticales/1.jpg","assets/images/webverticales/2.jpg","assets/images/webverticales/3.jpg","assets/images/webverticales/4.jpg","assets/images/webverticales/5.jpg","assets/images/webverticales/6.jpg","assets/images/webverticales/7.jpg","assets/images/webverticales/8.jpg","assets/images/webverticales/9.jpg","assets/images/webverticales/10.jpg","assets/images/webverticales/11.jpg","assets/images/webverticales/12.jpg","assets/images/webverticales/13.jpg","assets/images/webverticales/14.jpg","assets/images/webverticales/15.jpg"],planeGeometry=new THREE.PlaneGeometry(3,2),planeGeoVerti=new THREE.PlaneGeometry(3,4),phi=0,theta=0,goldNum=1.618033988749895,myVideos=document.querySelectorAll(".video");const imggroup=new THREE.Group,imgObjects=[];function fiboSphere(e,s,t,a){theta=2*Math.PI*s/goldNum,phi=Math.acos(1-2*(s+.5)/e);let i=new THREE.Spherical(a,phi,theta);t.position.setFromSpherical(i),t.lookAt(t.position.clone().setLength(3)),imggroup.add(t)}function imgSphere(e){let s=e.length,t=0;for(let a of e){let e=textureLoader.load(a);e.generateMipmaps=!1;let i=new THREE.MeshBasicMaterial({map:e});i.transparent=!1,i.side=THREE.DoubleSide,e.wrapS=THREE.RepeatWrapping,e.repeat.x=-1;let o=new THREE.Mesh(planeGeometry,i);t+=1,fiboSphere(s,t,o,10),imgObjects.push(o)}scene.add(imggroup)}function vertiSphere(e){let s=e.length,t=0;for(let a of e){let e=textureLoader.load(a);e.generateMipmaps=!1,e.wrapS=THREE.RepeatWrapping,e.repeat.x=-1;let i=new THREE.MeshBasicMaterial({map:e});i.transparent=!1,i.side=THREE.DoubleSide;let o=new THREE.Mesh(planeGeoVerti,i);t+=1,fiboSphere(s,t,o,12),imgObjects.push(o)}scene.add(imggroup)}function vidSphere(e){let s=0,t=e.length;for(let a of e){a.play();let e=new THREE.VideoTexture(a),i=new THREE.MeshBasicMaterial({map:e});i.side=THREE.DoubleSide,s+=1,fiboSphere(t,s,new THREE.Mesh(planeGeometry,i),6)}}imgSphere(imghorizon),vertiSphere(imgverticale),vidSphere(myVideos);const sizes={width:window.innerWidth,height:window.innerHeight};window.addEventListener("resize",(()=>{sizes.width=window.innerWidth,sizes.height=window.innerHeight,camera.aspect=sizes.width/sizes.height,camera.updateProjectionMatrix(),renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2))}));const raycaster=new THREE.Raycaster,mouse=new THREE.Vector2;window.addEventListener("mousemove",(e=>{mouse.x=e.clientX/sizes.width*2-1,mouse.y=-(e.clientY/sizes.height*2-1)}));let tl=gsap.timeline(),lightbox=document.querySelector(".lightbox"),imgOpen=!1;window.addEventListener("dblclick",(e=>{if(currentIntersect){for(let e=0;e<imgObjects.length;e++)currentIntersect.object===imgObjects[e]&&createImg(imgObjects[e].material.map.source.data.currentSrc);imgOpen=!0}})),window.addEventListener("click",(e=>{currentIntersect?console.log("clicked"):(removeImage(),console.log("should close img"))}));let imgbox=null,imgcreated=!1;function createImg(e){if(!1===imgcreated){let s=document.createElement("img");s.src=e,s.classList.add("imagebox","img-active"),lightbox.appendChild(s),imgbox=document.querySelector(".imagebox"),imgcreated=!0,tl.to(".lightbox",{opacity:1,duration:.5}).from(".imagebox",{opacity:0,duration:0}),imgbox.addEventListener("click",(e=>{removeImage()}))}else removeImage()}function removeImage(){!0===imgcreated&&(tl.to(".lightbox",{opacity:0,duration:1}),setTimeout((()=>{imgbox.remove(),console.log("erase img"),imgcreated=!1,imgOpen=!1}),1e3))}var fov=45;const camera=new THREE.PerspectiveCamera(fov,window.innerWidth/window.innerHeight,.05,1e3);camera.position.set(38,0,0),scene.add(camera),scene.background=new THREE.Color(855309);const trackballcontrols=new TrackballControls(camera,canvas);trackballcontrols.staticMoving=!1,trackballcontrols.dynamicDampingFactor=.05,trackballcontrols.rotateSpeed=.2,trackballcontrols.noPan=!0,trackballcontrols.zoomSpeed=.5,trackballcontrols.maxDistance=100,trackballcontrols.minDistance=0,trackballcontrols.update();const renderer=new THREE.WebGLRenderer({canvas});renderer.setSize(sizes.width,sizes.height),renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));const clock=new THREE.Clock;let currentIntersect=null,expbtn=document.querySelectorAll(".expbtn");for(let e=0;e<expbtn.length;e++)expbtn[e].addEventListener("click",resetcamera);function resetcamera(){gsap.to(camera.position,{x:30,y:0,z:0,duration:1,onUpdate:function(){trackballcontrols.reset()}}),console.log("rotation")}const plusicon='\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14" viewBox="0 0 14 14">\n  <defs>\n    <clipPath id="clip-Curseur_">\n      <rect width="14" height="14"/>\n    </clipPath>\n  </defs>\n  <g id="Curseur_" data-name="Curseur +" clip-path="url(#clip-Curseur_)">\n    <g id="Union_1" data-name="Union 1" transform="translate(-19470 -18693)">\n      <path d="M 19478.001953125 18705.25 L 19477.751953125 18705.25 L 19476.25 18705.25 L 19476 18705.25 L 19476 18705 L 19476 18701.001953125 L 19472.001953125 18701.001953125 L 19471.751953125 18701.001953125 L 19471.751953125 18700.751953125 L 19471.751953125 18699.25 L 19471.751953125 18699 L 19472.001953125 18699 L 19476 18699 L 19476 18695.001953125 L 19476 18694.751953125 L 19476.25 18694.751953125 L 19477.751953125 18694.751953125 L 19478.001953125 18694.751953125 L 19478.001953125 18695.001953125 L 19478.001953125 18699 L 19482 18699 L 19482.25 18699 L 19482.25 18699.25 L 19482.25 18700.751953125 L 19482.25 18701.001953125 L 19482 18701.001953125 L 19478.001953125 18701.001953125 L 19478.001953125 18705 L 19478.001953125 18705.25 Z" stroke="none"/>\n      <path d="M 19477.751953125 18705 L 19477.751953125 18700.751953125 L 19482 18700.751953125 L 19482 18699.25 L 19477.751953125 18699.25 L 19477.751953125 18695.001953125 L 19476.25 18695.001953125 L 19476.25 18699.25 L 19472.001953125 18699.25 L 19472.001953125 18700.751953125 L 19476.25 18700.751953125 L 19476.25 18705 L 19477.751953125 18705 M 19478.251953125 18705.5 L 19475.75 18705.5 L 19475.75 18701.251953125 L 19471.501953125 18701.251953125 L 19471.501953125 18698.75 L 19475.75 18698.75 L 19475.75 18694.501953125 L 19478.251953125 18694.501953125 L 19478.251953125 18698.75 L 19482.5 18698.75 L 19482.5 18701.251953125 L 19478.251953125 18701.251953125 L 19478.251953125 18705.5 Z" stroke="none" fill="#fff"/>\n    </g>\n  </g>\n</svg>\n',plusblob=new Blob([plusicon],{type:"image/svg+xml"}),iconplus=URL.createObjectURL(plusblob),tick=()=>{imggroup.rotation.y-=2e-4,raycaster.setFromCamera(mouse,camera);const e=raycaster.intersectObjects(imgObjects);e.length?(currentIntersect||(currentIntersect=e[0]),document.body.style.cursor="url("+iconplus+"), auto"):(currentIntersect&&(document.body.style.cursor="default"),currentIntersect=null),trackballcontrols.update(),renderer.render(scene,camera),window.requestAnimationFrame(tick)};tick();